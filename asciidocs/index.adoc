= Course Notes for "Apps with Web Components, redux and lit-html"
firstname lastname
1.0.0, 2020-06-25: Trainer: Adam Bien
ifndef::imagesdir[:imagesdir: images]
//:toc-placement!:  // prevents the generation of the doc at this position, so it can be printed afterwards
:sourcedir: ../src/main/java
:icons: font
:sectnums:    // Nummerierung der Überschriften / section numbering
:toc: left

//Need this blank line after ifdef, don't know why...
ifdef::backend-html5[]

// https://fontawesome.com/v4.7.0/icons/
icon:file-text-o[link=https://raw.githubusercontent.com/htl-leonding-college/asciidoctor-docker-template/master/asciidocs/{docname}.adoc] ‏ ‏ ‎
icon:github-square[link=https://github.com/htl-leonding-college/asciidoctor-docker-template] ‏ ‏ ‎
icon:home[link=https://htl-leonding.github.io/]
endif::backend-html5[]

// print the toc here (not at the default position)
//toc::[]


== GitHub-Repo

https://github.com/htl-leonding/redux-web-components-adam-bien-course

== Preparations

=== Install browser-sync

----
npm install -g browser-sync
----

=== Install Snowpack

https://www.snowpack.dev/

For installing redux; is a intelligent builder
Converts the proprietary module system from redux and lit-html and convert that to es6-module.

.Click, for the install-details
[%collapsible]
====
[source,shell]
----
mkdir dependencies
cd dependencies
npm init -y
npm i redux
----

.package.json
[source,yaml]
----
{
  "name": "dependencies",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "redux": "^4.0.5"
  }
}
----

////
// snowpack is not needed because redux now provides a working redux.mjs-file

----
npm install --save-dev snowpack
----

[source,yaml]
----
{
  "name": "dependencies",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "redux": "^4.0.5"
  },
  "devDependencies": {
    "snowpack": "^2.5.4"
  }
}
----

==== Add a simple js-File

.src/app.js
[source,javascript]
----
import 'redux/dist/redux.js'
----

image:add-app-js-for-snowpack.png[]

.Convert redux to es6-module
----
npx snowpack
----

image:install-snowpack.png[]


.Redux converted to ES6-module
image:redux-converted-to-es6-module.png[]

=== Copy the Redux-Lib

----
cd ../events
mkdir src/lib
cp ../dependencies/web_modules/redux/dist/redux.js ./src/lib
----

----
|-- events
|   `-- src
|       |-- app.js
|       |-- index.html
|       |-- lib
|       |   `-- redux.js
|       `-- style.css
----

////

====



=== Activate Module System

[source,javascript]
----
<!DOCTYPE html>
<html lang="en">
<head>
    <title>[WebStandards template]</title>
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <code>hello</code>
    <script src="app.js" type="module"></script> // <.>
</body>
</html>
----

// <.> type="module" acitvates the module system

=== Copy the redux.mjs - File

----
cd ../events
mkdir src/lib
cp ../dependencies/node_modules/redux/es/redux.mjs ../events/src/lib
----

----
|-- events
|   `-- src
|       |-- app.js
|       |-- index.html
|       |-- lib
|       |   `-- redux.js
|       `-- style.css
----

=== Redux

Redux is a central Singleton, where we can store json- or javascript-objects.
These objects can only modified by functuons, called reducers.
We can subscribe to notifications of this store.


== First Program

[source,javascript]
----
import { createStore } from "./lib/redux.mjs";

const multiply = ( state = 21, action) => {
    console.log(state, action);
    return state * action.payload;
}

const store = createStore(multiply);

const initial = store.getState();
console.log('initial', initial);
----

.Problem: the first 'action' is a init-action, so the action-type has to be determined
image:first-program.png[]

[source,javascript]
----
import { createStore } from "./lib/redux.mjs";

const multiply = ( state = 21, action) => {
    console.log(state, action);
    if (action.type === 'M') {
        return state * action.payload;
    }
    return state;
}

const store = createStore(multiply);

const initial = store.getState();
console.log('initial', initial);
----

.only the state is displayed
image:first-program-2.png[]

=== Create a Subscription

[source,javascript]
----
import { createStore } from "./lib/redux.mjs";

const multiply = ( state = 21, action) => {
    console.log(state, action);
    if (action.type === 'M') {
        return state * action.payload;
    }
    return state;
}

const store = createStore(multiply);

// subscribe to changes
store.subscribe(_ => console.log('state changed', store.getState())); // <.>

const initial = store.getState();
console.log('initial', initial);

// changes the value
store.dispatch({ // <.>
    type: 'M',
    payload: 2
})

console.log(store.getState());
----

<.> subscribe to changes
<.> changes the value

image:first-program-3-subscription.png[]

